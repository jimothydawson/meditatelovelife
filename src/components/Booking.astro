---
/**
 * Booking section
 * Content source: src/content/booking.json
 * CMS fields: heading, intro, embedType, embedCode, fallbackCta, fallbackEmail, fallbackEmailLabel
 *
 * How this works:
 *   - While embedType contains "PLACEHOLDER", the section renders the email fallback.
 *   - Once embedType is set to 'square', 'acuity', or 'calendly', a developer
 *     adds the embed code and this section becomes the booking widget.
 *   - The CMS can update the text fields (heading, intro, fallbackCta) directly.
 */
import booking from '../content/booking.json';

// Show fallback contact prompt until an embed type is properly set
const hasEmbed = !booking.embedType.startsWith('PLACEHOLDER');
---

<section id="booking" class="section section--sage booking">
  <div class="container booking__inner">

    <div class="booking__header" data-reveal>
      <span class="section-label">Ready to begin</span>
      <h2 class="section-heading">
        {booking.heading}
      </h2>
      <p class="section-intro">
        {booking.intro}
      </p>
    </div>

    {hasEmbed ? (
      <div class="booking__embed" set:html={booking.embedCode} data-reveal class="delay-100" />
    ) : (
      <!-- Fallback: direct email prompt -->
      <div class="booking__fallback" data-reveal class="delay-100">
        <p class="booking__fallback-text">
          {booking.fallbackCta}
        </p>
        <a
          href={`mailto:${booking.fallbackEmail}`}
          class="booking__email-link"
          aria-label={`Email Kari at ${booking.fallbackEmailLabel}`}
        >
          {booking.fallbackEmailLabel}
        </a>
        <p class="booking__embed-note">
          Online booking is coming soon. In the meantime, reach out directly and Kari will get back to you promptly.
        </p>
      </div>
    )}

  </div>
</section>

<style>
  .booking {
    background-color: var(--color-bg);
    border-top: 1px solid var(--color-border);
  }

  .booking__inner {
    max-width: 48rem;
    margin-inline: auto;
    text-align: center;
  }

  .booking__header {
    margin-bottom: 4rem;
  }

  .booking__header .section-intro {
    margin-inline: auto;
  }

  /* Embed container */
  .booking__embed {
    width: 100%;
    min-height: 500px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    background-color: var(--color-white);
  }

  /* Fallback email prompt */
  .booking__fallback {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    padding: 4rem 2rem;
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
  }

  .booking__fallback-text {
    font-size: var(--text-base);
    color: var(--color-muted);
    max-width: none;
  }

  .booking__email-link {
    font-size: clamp(var(--text-xl), 4vw, var(--text-3xl));
    font-weight: var(--font-weight-light);
    color: var(--color-accent);
    text-decoration: none;
    line-height: 1;
    border-bottom: 2px solid transparent;
    transition: all var(--transition-base);
    padding-bottom: 4px;
  }

  .booking__email-link:hover {
    color: var(--color-accent-hover);
    border-bottom-color: var(--color-accent-hover);
  }

  .booking__embed-note {
    font-size: var(--text-xs);
    color: var(--color-muted);
    font-style: italic;
    max-width: 24rem;
    margin-top: 1rem;
    opacity: 0.8;
  }
</style>
